<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Marketplace Kurulumu - Museumeme</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>Museumeme - Marketplace Kurulumu</h1>
</header>

<section class="hero">
    <h2>Marketplace'i BaÅŸlat</h2>
    <p>Bu iÅŸlem yalnÄ±zca 1 kez yapÄ±lÄ±r. Kurulumdan sonra satÄ±ÅŸlar aktif olur.</p>

    <p><b>Komisyon CÃ¼zdanÄ±:</b></p>
    <p style="color:#ffcc00; font-size:18px;">
        9JUR8xVSNFN2v8Xmz5JqJHRHp8AB3hZiTQf9sNzLEzTP
    </p>

    <button class="btn" id="setupBtn">Marketplaceâ€™i Kur</button>

    <p id="setupStatus" style="margin-top:20px; font-weight:bold;"></p>
</section>

<script src="wallet.js"></script>

<script type="module">

// Solana ve Metaplex import
import {
    Connection,
    PublicKey
} from "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.89.0/+esm";

import {
    Metaplex,
    walletAdapterIdentity
} from "https://esm.sh/@metaplex-foundation/js@0.19.5";


document.getElementById("setupBtn").addEventListener("click", async () => {

    const status = document.getElementById("setupStatus");
    status.innerText = "âš™ï¸ Kurulum baÅŸlatÄ±lÄ±yor...";

    // Solana baÄŸlantÄ±sÄ±
    const connection = new Connection("https://api.mainnet-beta.solana.com");

    // Phantom cÃ¼zdan
    const wallet = window.solana;

    if (!wallet || !wallet.isPhantom) {
        alert("Phantom Wallet gerekiyor!");
        return;
    }

    await wallet.connect();

    const pubkey = wallet.publicKey.toString();

    status.innerText = "â³ Blockchain'e yazÄ±lÄ±yor...";

    // Metaplex baÅŸlat
    const metaplex = Metaplex.make(connection)
        .use(walletAdapterIdentity(wallet));

    try {
        // Marketplace ayarÄ± metadata olarak kaydedilir
        const { uri } = await metaplex.nfts().uploadMetadata({
            name: "Museumeme Marketplace",
            description: "Official marketplace settings",
            commissionWallet: "9JUR8xVSNFN2v8Xmz5JqJHRHp8AB3hZiTQf9sNzLEzTP",
            commissionRate: "2%"
        });

        status.innerText = "âœ” Metadata oluÅŸturuldu. Marketplace aktif ediliyor...";

        const { nft } = await metaplex.nfts().create({
            uri,
            name: "Museumeme Marketplace",
            sellerFeeBasisPoints: 200, // %2 komisyon
            seller: new PublicKey(pubkey)
        });

        status.innerText =
            "ğŸ‰ Marketplace baÅŸarÄ±yla kuruldu!\nAyar NFT'si: " + nft.address.toString();

        alert("Marketplace hazÄ±r!");

    } catch (err) {
        console.error(err);
        status.innerText = "âŒ Hata oluÅŸtu: " + err.message;
        alert("Kurulum yapÄ±lamadÄ±.");
    }
});

</script>

</body>
</html>
